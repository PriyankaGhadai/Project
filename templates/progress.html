{% extends "base.html" %}
{% load i18n %}

{% block title %} {% trans "Progress Page" %} {% endblock %}
{% block description %} {% trans "User Progress Page" %} {% endblock %}

{% block content %}

<div id="input-nav"><a href="{% url 'home' %}" class="primary1">Home</a> <i>&rsaquo;</i> Progress Page</div>
<canvas id="progressGraph" width="400" height="200"></canvas>
{% if cat_scores %}

<div class="header-title text-center">{% trans "Question Category Scores" %}</div>
<div class="title-line"></div>

<table class="table table-bordered table-striped">

	<thead>
		<tr>
			<th>{% trans "Category" %}</th>
			<th>{% trans "Correctly answererd" %}</th>
			<th>{% trans "Incorrect" %}</th>
			<th>%</th>
		</tr>
	</thead>

	<tbody>


		{% for cat, value in cat_scores.items %}
		<tr>
			<td>{{ cat }}</td>
			<td>{{ value.0 }}</td>
			<td>{{ value.1 }}</td>
			<td>{{ value.2 }}</td>
		</tr>

		{% endfor %}

	</tbody>

</table>


{% endif %}

{% if exams %}

<hr>

<div class="header-title-xl">{% trans "Previous exam papers" %}</div>
<p class="lead text-muted">
	{% trans "Below are the results of exams that you have sat." %}
</p>
<div class="info-text bg-danger mb-2">Total complete exams: {{ exams_counter }}</div>
<div class="table-responsive">
	<table class="table table-bordered table-striped">

		<thead>
			<tr>
				<th>#</th>
				<th>{% trans "Quiz Title" %}</th>
				<th>{% trans "Score" %}</th>
				<th>{% trans "Possible Score" %}</th>
				<th>Out of 100%</th>
			</tr>
		</thead>

		<tbody>

			{% for exam in exams %}

			<tr>
				<td>{{ forloop.counter }}</td>
				<td>{{ exam.quiz.title }}</td>
				<td>{{ exam.current_score }}</td>
				<td>{{ exam.get_max_score }}</td>
				<td>{{ exam.get_percent_correct }}%</td>
			</tr>

			{% endfor %}

		</tbody>

	</table>
</div>
{% endif %}
{% if not cat_scores and not exams %}
<div class="col-12 p-4 text-center">
	<h3><i class="far fa-frown"></i></h3> No recordes yet. to get a good recorde, try to do some quizzes in your course.
</div>
{% endif %}
<!-- Add Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const catScores = JSON.parse('{{ cat_scores | safe }}');
        
        // Extract category names and scores
        const categories = Object.keys(catScores);
        const correctAnswers = categories.map(cat => catScores[cat][0]);
        const incorrectAnswers = categories.map(cat => catScores[cat][1]);
        
        // Create the graph
        const ctx = document.getElementById("progressGraph").getContext("2d");
        new Chart(ctx, {
            type: "bar",
            data: {
                labels: categories,
                datasets: [
                    {
                        label: "Correctly Answered",
                        backgroundColor: "rgba(75, 192, 192, 0.2)",
                        borderColor: "rgba(75, 192, 192, 1)",
                        borderWidth: 1,
                        data: correctAnswers,
                    },
                    {
                        label: "Incorrect",
                        backgroundColor: "rgba(255, 99, 132, 0.2)",
                        borderColor: "rgba(255, 99, 132, 1)",
                        borderWidth: 1,
                        data: incorrectAnswers,
                    },
                ],
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true,
                        stacked: true,
                    },
                },
            },
        });
    });
</script>

{% endblock %}